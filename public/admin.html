<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | SeaSalt Pickles</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pickle': {
                            50: '#FFF7ED',
                            100: '#FFEDD5',
                            500: '#D4451A',
                            600: '#C2410C',
                            700: '#9A3412',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Chart.js for Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .sidebar-link.active { background: #D4451A; color: white; }
        .sidebar-link:hover:not(.active) { background: #FFF7ED; }
        .status-pending { background: #FEF3C7; color: #92400E; }
        .status-confirmed { background: #DBEAFE; color: #1E40AF; }
        .status-shipped { background: #E0E7FF; color: #3730A3; }
        .status-delivered { background: #D1FAE5; color: #065F46; }
        .status-cancelled { background: #FEE2E2; color: #991B1B; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-pickle-500 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <span class="text-3xl">ü´ô</span>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Admin Login</h1>
                <p class="text-gray-500 text-sm mt-1">SeaSalt Pickles Dashboard</p>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Username</label>
                    <input type="text" id="admin-username" value="admin" 
                        class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="admin-password" placeholder="Enter password"
                        class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                </div>
                <button onclick="handleLogin()" 
                    class="w-full py-3 bg-pickle-500 text-white font-bold rounded-xl hover:bg-pickle-600 transition-colors">
                    Login
                </button>
                <p id="login-error" class="text-red-500 text-sm text-center hidden">Invalid credentials</p>
            </div>
            
            <p class="text-center text-gray-400 text-xs mt-6">Default: admin / seasalt2024</p>
        </div>
    </div>
    
    <!-- Main Admin Panel -->
    <div id="admin-panel" class="hidden">
        <!-- Sidebar -->
        <aside class="fixed left-0 top-0 bottom-0 w-64 bg-white shadow-lg z-40">
            <div class="p-6 border-b">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-pickle-500 rounded-xl flex items-center justify-center">
                        <span class="text-xl">ü´ô</span>
                    </div>
                    <div>
                        <h1 class="font-bold text-gray-800">SeaSalt Admin</h1>
                        <p class="text-xs text-gray-500">Management Panel</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4 space-y-2">
                <a href="#" onclick="showPage('dashboard')" class="sidebar-link active flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>üìä</span>
                    <span class="font-medium">Dashboard</span>
                </a>
                <a href="#" onclick="showPage('orders')" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>üì¶</span>
                    <span class="font-medium">Orders</span>
                </a>
                <a href="#" onclick="showPage('shipping')" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>üöö</span>
                    <span class="font-medium">Shipping</span>
                </a>
                <a href="#" onclick="showPage('analytics')" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>üìà</span>
                    <span class="font-medium">Analytics</span>
                </a>
                <a href="#" onclick="showPage('products')" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>üè∑Ô∏è</span>
                    <span class="font-medium">Products</span>
                </a>
                <a href="#" onclick="showPage('customers')" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>üë•</span>
                    <span class="font-medium">Customers</span>
                </a>
                <a href="#" onclick="showPage('settings')" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl transition-colors">
                    <span>‚öôÔ∏è</span>
                    <span class="font-medium">Settings</span>
                </a>
            </nav>
            
            <div class="absolute bottom-0 left-0 right-0 p-4 border-t">
                <button onclick="handleLogout()" class="w-full flex items-center justify-center gap-2 px-4 py-3 text-red-500 hover:bg-red-50 rounded-xl transition-colors">
                    <span>üö™</span>
                    <span class="font-medium">Logout</span>
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="ml-64 p-8">
            <!-- Header -->
            <header class="flex items-center justify-between mb-8">
                <div>
                    <h2 class="text-2xl font-bold text-gray-800" id="page-title">Dashboard</h2>
                    <p class="text-gray-500 text-sm" id="page-subtitle">Welcome back, Admin</p>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="refreshData()" class="px-4 py-2 bg-white border rounded-xl hover:bg-gray-50 flex items-center gap-2">
                        <span>üîÑ</span>
                        <span>Refresh</span>
                    </button>
                    <a href="/" target="_blank" class="px-4 py-2 bg-pickle-500 text-white rounded-xl hover:bg-pickle-600 flex items-center gap-2">
                        <span>üåê</span>
                        <span>View Site</span>
                    </a>
                </div>
            </header>
            
            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page">
                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-3xl">üì¶</span>
                            <span class="text-xs px-2 py-1 bg-green-100 text-green-600 rounded-full">+12%</span>
                        </div>
                        <p class="text-gray-500 text-sm">Total Orders</p>
                        <p class="text-3xl font-bold text-gray-800" id="stat-total-orders">0</p>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-3xl">üí∞</span>
                            <span class="text-xs px-2 py-1 bg-green-100 text-green-600 rounded-full">+8%</span>
                        </div>
                        <p class="text-gray-500 text-sm">Total Revenue</p>
                        <p class="text-3xl font-bold text-gray-800" id="stat-revenue">‚Çπ0</p>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-3xl">‚è≥</span>
                            <span class="text-xs px-2 py-1 bg-yellow-100 text-yellow-600 rounded-full">Pending</span>
                        </div>
                        <p class="text-gray-500 text-sm">Pending Orders</p>
                        <p class="text-3xl font-bold text-gray-800" id="stat-pending">0</p>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <span class="text-3xl">‚úÖ</span>
                            <span class="text-xs px-2 py-1 bg-blue-100 text-blue-600 rounded-full">Shipped</span>
                        </div>
                        <p class="text-gray-500 text-sm">Shipped Today</p>
                        <p class="text-3xl font-bold text-gray-800" id="stat-shipped">0</p>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-4">Revenue (Last 7 Days)</h3>
                        <canvas id="revenue-chart" height="200"></canvas>
                    </div>
                    
                    <div class="bg-white rounded-2xl p-6 shadow-sm">
                        <h3 class="font-bold text-gray-800 mb-4">Orders by Status</h3>
                        <canvas id="status-chart" height="200"></canvas>
                    </div>
                </div>
                
                <!-- Recent Orders -->
                <div class="bg-white rounded-2xl shadow-sm">
                    <div class="p-6 border-b flex items-center justify-between">
                        <h3 class="font-bold text-gray-800">Recent Orders</h3>
                        <a href="#" onclick="showPage('orders')" class="text-pickle-500 text-sm font-medium">View All ‚Üí</a>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Items</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                </tr>
                            </thead>
                            <tbody id="recent-orders-table" class="divide-y">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Orders Page -->
            <div id="page-orders" class="page hidden">
                <!-- Filters -->
                <div class="bg-white rounded-2xl p-4 shadow-sm mb-6 flex flex-wrap items-center gap-4">
                    <div class="flex-1 min-w-[200px]">
                        <input type="text" id="search-orders" placeholder="Search orders..." 
                            class="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                    </div>
                    <select id="filter-status" onchange="filterOrders()" 
                        class="px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                        <option value="">All Status</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="processing">Processing</option>
                        <option value="shipped">Shipped</option>
                        <option value="delivered">Delivered</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="filter-date" onchange="filterOrders()"
                        class="px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                </div>
                
                <!-- Orders Table -->
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Items</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Total</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Payment</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                <th class="px-6 py-4 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table" class="divide-y">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                    
                    <div id="no-orders" class="hidden p-12 text-center">
                        <div class="text-6xl mb-4">üì≠</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">No orders found</h3>
                        <p class="text-gray-500">Orders will appear here when customers place them</p>
                    </div>
                </div>
            </div>
            
            <!-- Shipping Page -->
            <div id="page-shipping" class="page hidden">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- Shipping Partners -->
                    <div class="lg:col-span-1">
                        <div class="bg-white rounded-2xl shadow-sm p-6">
                            <h3 class="font-bold text-gray-800 mb-4">Shipping Partners</h3>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between p-3 border rounded-xl">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                            <span class="font-bold text-red-600">D</span>
                                        </div>
                                        <div>
                                            <p class="font-medium">Delhivery</p>
                                            <p class="text-xs text-gray-500">Express Delivery</p>
                                        </div>
                                    </div>
                                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 border rounded-xl">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                            <span class="font-bold text-blue-600">DTDC</span>
                                        </div>
                                        <div>
                                            <p class="font-medium">DTDC</p>
                                            <p class="text-xs text-gray-500">Standard Delivery</p>
                                        </div>
                                    </div>
                                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 border rounded-xl">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                            <span class="font-bold text-yellow-600">DHL</span>
                                        </div>
                                        <div>
                                            <p class="font-medium">DHL</p>
                                            <p class="text-xs text-gray-500">International</p>
                                        </div>
                                    </div>
                                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                                </div>
                                
                                <div class="flex items-center justify-between p-3 border rounded-xl border-dashed">
                                    <div class="flex items-center gap-3">
                                        <div class="w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center">
                                            <span class="text-gray-400">+</span>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-400">Add Partner</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pending Shipments -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-2xl shadow-sm">
                            <div class="p-6 border-b">
                                <h3 class="font-bold text-gray-800">Pending Shipments</h3>
                                <p class="text-sm text-gray-500">Orders ready to be shipped</p>
                            </div>
                            <div id="pending-shipments" class="divide-y">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Shipments -->
                <div class="bg-white rounded-2xl shadow-sm">
                    <div class="p-6 border-b">
                        <h3 class="font-bold text-gray-800">Recent Shipments</h3>
                    </div>
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Destination</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Partner</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tracking #</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                            </tr>
                        </thead>
                        <tbody id="shipments-table" class="divide-y">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Analytics Page -->
            <div id="page-analytics" class="page hidden">
                <!-- Analytics Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-8">
                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <p class="text-gray-500 text-sm">Total Sessions</p>
                        <p class="text-2xl font-bold text-gray-800" id="analytics-sessions">0</p>
                    </div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <p class="text-gray-500 text-sm">Page Views</p>
                        <p class="text-2xl font-bold text-gray-800" id="analytics-pageviews">0</p>
                    </div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <p class="text-gray-500 text-sm">Avg. Session</p>
                        <p class="text-2xl font-bold text-gray-800" id="analytics-avgsession">0s</p>
                    </div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <p class="text-gray-500 text-sm">Bounce Rate</p>
                        <p class="text-2xl font-bold text-gray-800" id="analytics-bounce">0%</p>
                    </div>
                    <div class="bg-white rounded-2xl p-5 shadow-sm">
                        <p class="text-gray-500 text-sm">Conversion Rate</p>
                        <p class="text-2xl font-bold text-green-600" id="analytics-conversion">0%</p>
                    </div>
                </div>
                
                <!-- Conversion Funnel -->
                <div class="bg-white rounded-2xl shadow-sm p-6 mb-8">
                    <h3 class="font-bold text-gray-800 mb-6">Conversion Funnel</h3>
                    <div class="flex items-center justify-between">
                        <div class="flex-1 text-center">
                            <div class="w-20 h-20 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-2">
                                <span class="text-2xl font-bold text-blue-600" id="funnel-views">0</span>
                            </div>
                            <p class="text-sm text-gray-600">Page Views</p>
                            <p class="text-xs text-gray-400">100%</p>
                        </div>
                        <div class="text-gray-300 text-2xl">‚Üí</div>
                        <div class="flex-1 text-center">
                            <div class="w-20 h-20 mx-auto bg-purple-100 rounded-full flex items-center justify-center mb-2">
                                <span class="text-2xl font-bold text-purple-600" id="funnel-product">0</span>
                            </div>
                            <p class="text-sm text-gray-600">Product Views</p>
                            <p class="text-xs text-gray-400" id="funnel-product-pct">0%</p>
                        </div>
                        <div class="text-gray-300 text-2xl">‚Üí</div>
                        <div class="flex-1 text-center">
                            <div class="w-20 h-20 mx-auto bg-orange-100 rounded-full flex items-center justify-center mb-2">
                                <span class="text-2xl font-bold text-orange-600" id="funnel-cart">0</span>
                            </div>
                            <p class="text-sm text-gray-600">Add to Cart</p>
                            <p class="text-xs text-gray-400" id="funnel-cart-pct">0%</p>
                        </div>
                        <div class="text-gray-300 text-2xl">‚Üí</div>
                        <div class="flex-1 text-center">
                            <div class="w-20 h-20 mx-auto bg-yellow-100 rounded-full flex items-center justify-center mb-2">
                                <span class="text-2xl font-bold text-yellow-600" id="funnel-checkout">0</span>
                            </div>
                            <p class="text-sm text-gray-600">Checkout</p>
                            <p class="text-xs text-gray-400" id="funnel-checkout-pct">0%</p>
                        </div>
                        <div class="text-gray-300 text-2xl">‚Üí</div>
                        <div class="flex-1 text-center">
                            <div class="w-20 h-20 mx-auto bg-green-100 rounded-full flex items-center justify-center mb-2">
                                <span class="text-2xl font-bold text-green-600" id="funnel-purchase">0</span>
                            </div>
                            <p class="text-sm text-gray-600">Purchase</p>
                            <p class="text-xs text-gray-400" id="funnel-purchase-pct">0%</p>
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Page Performance -->
                    <div class="bg-white rounded-2xl shadow-sm">
                        <div class="p-6 border-b">
                            <h3 class="font-bold text-gray-800">Page Performance</h3>
                            <p class="text-sm text-gray-500">Time spent on each page</p>
                        </div>
                        <div class="p-6">
                            <table class="w-full">
                                <thead>
                                    <tr class="text-left text-xs text-gray-500 uppercase">
                                        <th class="pb-3">Page</th>
                                        <th class="pb-3">Visits</th>
                                        <th class="pb-3">Avg. Time</th>
                                        <th class="pb-3">Bounce</th>
                                    </tr>
                                </thead>
                                <tbody id="page-performance-table" class="text-sm">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Device Breakdown -->
                    <div class="bg-white rounded-2xl shadow-sm">
                        <div class="p-6 border-b">
                            <h3 class="font-bold text-gray-800">Devices & Sources</h3>
                        </div>
                        <div class="p-6">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <p class="text-sm text-gray-500 mb-3">Device Type</p>
                                    <canvas id="device-chart" height="150"></canvas>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-500 mb-3">Traffic Sources</p>
                                    <div id="sources-list" class="space-y-2">
                                        <!-- Populated by JS -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Top Products -->
                <div class="bg-white rounded-2xl shadow-sm mb-8">
                    <div class="p-6 border-b">
                        <h3 class="font-bold text-gray-800">Top Products</h3>
                        <p class="text-sm text-gray-500">Most viewed and purchased products</p>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Views</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cart Adds</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Purchases</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Revenue</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Conv. Rate</th>
                                </tr>
                            </thead>
                            <tbody id="top-products-table" class="divide-y">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Recent Events -->
                <div class="bg-white rounded-2xl shadow-sm">
                    <div class="p-6 border-b flex items-center justify-between">
                        <div>
                            <h3 class="font-bold text-gray-800">Live Activity Feed</h3>
                            <p class="text-sm text-gray-500">Recent user events</p>
                        </div>
                        <button onclick="clearAnalyticsData()" class="px-4 py-2 text-red-500 hover:bg-red-50 rounded-lg text-sm">
                            Clear Data
                        </button>
                    </div>
                    <div id="events-feed" class="max-h-96 overflow-y-auto divide-y">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
            
            <!-- Products Page -->
            <div id="page-products" class="page hidden">
                <div class="bg-white rounded-2xl shadow-sm p-12 text-center">
                    <div class="text-6xl mb-4">üè∑Ô∏è</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Product Management</h3>
                    <p class="text-gray-500 mb-4">Manage your products from here</p>
                    <p class="text-sm text-gray-400">Coming soon...</p>
                </div>
            </div>
            
            <!-- Customers Page -->
            <div id="page-customers" class="page hidden">
                <div class="bg-white rounded-2xl shadow-sm p-12 text-center">
                    <div class="text-6xl mb-4">üë•</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Customer Management</h3>
                    <p class="text-gray-500 mb-4">View and manage customers</p>
                    <p class="text-sm text-gray-400">Coming soon...</p>
                </div>
            </div>
            
            <!-- Settings Page -->
            <div id="page-settings" class="page hidden">
                <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h3 class="font-bold text-gray-800 mb-6">Admin Settings</h3>
                    
                    <div class="space-y-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Admin Password</label>
                            <div class="flex gap-3">
                                <input type="password" id="new-password" placeholder="New password" 
                                    class="flex-1 px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                                <button onclick="updatePassword()" class="px-6 py-2 bg-pickle-500 text-white rounded-xl hover:bg-pickle-600">
                                    Update
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Store Name</label>
                            <input type="text" value="SeaSalt Pickles" 
                                class="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Contact Email</label>
                            <input type="email" value="support@seasaltpickles.com" 
                                class="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Contact Phone</label>
                            <input type="tel" value="+91-9963971447" 
                                class="w-full px-4 py-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Order Detail Modal -->
    <div id="order-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeOrderModal()"></div>
        <div class="absolute top-0 right-0 bottom-0 w-full max-w-xl bg-white shadow-2xl overflow-y-auto">
            <div class="sticky top-0 bg-white p-6 border-b flex items-center justify-between">
                <h3 class="text-xl font-bold text-gray-800">Order Details</h3>
                <button onclick="closeOrderModal()" class="w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center">
                    <span>‚úï</span>
                </button>
            </div>
            <div id="order-modal-content" class="p-6">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>
    
    <!-- Shipping Assignment Modal -->
    <div id="shipping-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeShippingModal()"></div>
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-md bg-white rounded-2xl shadow-2xl">
            <div class="p-6 border-b">
                <h3 class="text-xl font-bold text-gray-800">Assign Shipping</h3>
                <p class="text-sm text-gray-500">Order: <span id="shipping-order-id"></span></p>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Shipping Partner</label>
                    <select id="shipping-partner" class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                        <option value="">Select Partner</option>
                        <option value="delhivery">Delhivery</option>
                        <option value="dtdc">DTDC</option>
                        <option value="dhl">DHL</option>
                        <option value="manual">Manual / Other</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Tracking Number</label>
                    <input type="text" id="tracking-number" placeholder="Enter tracking number"
                        class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Notes (Optional)</label>
                    <textarea id="shipping-notes" placeholder="Any special instructions..."
                        class="w-full px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:ring-pickle-500 resize-none" rows="2"></textarea>
                </div>
            </div>
            <div class="p-6 border-t flex gap-3">
                <button onclick="closeShippingModal()" class="flex-1 py-3 border rounded-xl font-medium hover:bg-gray-50">
                    Cancel
                </button>
                <button onclick="confirmShipping()" class="flex-1 py-3 bg-pickle-500 text-white rounded-xl font-bold hover:bg-pickle-600">
                    Confirm & Ship
                </button>
            </div>
        </div>
    </div>
    
    <!-- Toast -->
    <div id="toast" class="fixed bottom-6 right-6 bg-gray-800 text-white px-6 py-3 rounded-xl shadow-lg hidden transition-all transform translate-y-4 opacity-0">
        <span id="toast-message">Message</span>
    </div>

    <script>
        // ============================================
        // ADMIN CONFIGURATION
        // ============================================
        
        const ADMIN_CONFIG = {
            username: 'admin',
            password: 'seasalt2024', // Change this!
            storageKey: 'seasalt_admin_auth'
        };
        
        // ============================================
        // STATE
        // ============================================
        
        let currentPage = 'dashboard';
        let orders = [];
        let selectedOrderId = null;
        
        // ============================================
        // AUTHENTICATION
        // ============================================
        
        function handleLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            
            // Check stored password first, then default
            const storedPassword = localStorage.getItem('seasalt_admin_password') || ADMIN_CONFIG.password;
            
            if (username === ADMIN_CONFIG.username && password === storedPassword) {
                localStorage.setItem(ADMIN_CONFIG.storageKey, 'true');
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                loadData();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
                setTimeout(() => {
                    document.getElementById('login-error').classList.add('hidden');
                }, 3000);
            }
        }
        
        function handleLogout() {
            localStorage.removeItem(ADMIN_CONFIG.storageKey);
            document.getElementById('admin-panel').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('admin-password').value = '';
        }
        
        function checkAuth() {
            if (localStorage.getItem(ADMIN_CONFIG.storageKey) === 'true') {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                loadData();
            }
        }
        
        function updatePassword() {
            const newPassword = document.getElementById('new-password').value;
            if (newPassword.length < 6) {
                showToast('Password must be at least 6 characters');
                return;
            }
            localStorage.setItem('seasalt_admin_password', newPassword);
            document.getElementById('new-password').value = '';
            showToast('Password updated successfully!');
        }
        
        // ============================================
        // NAVIGATION
        // ============================================
        
        function showPage(page) {
            currentPage = page;
            
            // Update sidebar
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.closest('.sidebar-link').classList.add('active');
            
            // Update pages
            document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
            document.getElementById(`page-${page}`).classList.remove('hidden');
            
            // Update header
            const titles = {
                dashboard: ['Dashboard', 'Welcome back, Admin'],
                orders: ['Orders', 'Manage customer orders'],
                shipping: ['Shipping', 'Manage deliveries'],
                analytics: ['Analytics', 'User behavior & conversion data'],
                products: ['Products', 'Manage your products'],
                customers: ['Customers', 'View customer data'],
                settings: ['Settings', 'Admin configuration']
            };
            
            document.getElementById('page-title').textContent = titles[page][0];
            document.getElementById('page-subtitle').textContent = titles[page][1];
            
            // Refresh data for specific pages
            if (page === 'shipping') {
                renderPendingShipments();
            }
            if (page === 'analytics') {
                loadAnalyticsData();
            }
        }
        
        // ============================================
        // DATA LOADING
        // ============================================
        
        function loadData() {
            // Load orders from localStorage
            orders = JSON.parse(localStorage.getItem('seasalt_orders') || '[]');
            
            // Update dashboard
            updateDashboardStats();
            renderRecentOrders();
            renderCharts();
            renderOrdersTable();
            renderPendingShipments();
            renderShipmentsTable();
        }
        
        function refreshData() {
            loadData();
            showToast('Data refreshed!');
        }
        
        // ============================================
        // DASHBOARD
        // ============================================
        
        function updateDashboardStats() {
            const totalOrders = orders.length;
            const revenue = orders.reduce((sum, o) => sum + (o.total || 0), 0);
            const pending = orders.filter(o => o.status === 'confirmed' || o.status === 'processing').length;
            const shipped = orders.filter(o => {
                const today = new Date().toDateString();
                const orderDate = new Date(o.shippedAt || o.createdAt).toDateString();
                return o.status === 'shipped' && today === orderDate;
            }).length;
            
            document.getElementById('stat-total-orders').textContent = totalOrders;
            document.getElementById('stat-revenue').textContent = '‚Çπ' + revenue.toLocaleString('en-IN');
            document.getElementById('stat-pending').textContent = pending;
            document.getElementById('stat-shipped').textContent = shipped;
        }
        
        function renderRecentOrders() {
            const container = document.getElementById('recent-orders-table');
            const recent = orders.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                            No orders yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            container.innerHTML = recent.map(order => `
                <tr class="hover:bg-gray-50 cursor-pointer" onclick="viewOrder('${order.id}')">
                    <td class="px-6 py-4 font-medium text-pickle-600">${order.id}</td>
                    <td class="px-6 py-4">${order.address?.fullName || 'N/A'}</td>
                    <td class="px-6 py-4">${order.items?.length || 0} items</td>
                    <td class="px-6 py-4 font-medium">‚Çπ${(order.total || 0).toLocaleString('en-IN')}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium status-${order.status || 'confirmed'}">
                            ${(order.status || 'confirmed').charAt(0).toUpperCase() + (order.status || 'confirmed').slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-gray-500">${formatDate(order.createdAt)}</td>
                </tr>
            `).join('');
        }
        
        function renderCharts() {
            // Revenue Chart
            const revenueCtx = document.getElementById('revenue-chart').getContext('2d');
            const last7Days = getLast7DaysData();
            
            new Chart(revenueCtx, {
                type: 'line',
                data: {
                    labels: last7Days.labels,
                    datasets: [{
                        label: 'Revenue',
                        data: last7Days.revenue,
                        borderColor: '#D4451A',
                        backgroundColor: 'rgba(212, 69, 26, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // Status Chart
            const statusCtx = document.getElementById('status-chart').getContext('2d');
            const statusData = getStatusData();
            
            new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Confirmed', 'Processing', 'Shipped', 'Delivered', 'Cancelled'],
                    datasets: [{
                        data: [statusData.confirmed, statusData.processing, statusData.shipped, statusData.delivered, statusData.cancelled],
                        backgroundColor: ['#3B82F6', '#F59E0B', '#8B5CF6', '#10B981', '#EF4444']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { position: 'bottom' } }
                }
            });
        }
        
        function getLast7DaysData() {
            const labels = [];
            const revenue = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-IN', { weekday: 'short' }));
                
                const dayRevenue = orders
                    .filter(o => new Date(o.createdAt).toDateString() === date.toDateString())
                    .reduce((sum, o) => sum + (o.total || 0), 0);
                revenue.push(dayRevenue);
            }
            
            return { labels, revenue };
        }
        
        function getStatusData() {
            return {
                confirmed: orders.filter(o => o.status === 'confirmed').length,
                processing: orders.filter(o => o.status === 'processing').length,
                shipped: orders.filter(o => o.status === 'shipped').length,
                delivered: orders.filter(o => o.status === 'delivered').length,
                cancelled: orders.filter(o => o.status === 'cancelled').length
            };
        }
        
        // ============================================
        // ORDERS
        // ============================================
        
        function renderOrdersTable() {
            const container = document.getElementById('orders-table');
            const noOrders = document.getElementById('no-orders');
            
            if (orders.length === 0) {
                container.innerHTML = '';
                noOrders.classList.remove('hidden');
                return;
            }
            
            noOrders.classList.add('hidden');
            
            container.innerHTML = orders.map(order => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-pickle-600">${order.id}</td>
                    <td class="px-6 py-4">
                        <div>
                            <p class="font-medium">${order.address?.fullName || 'N/A'}</p>
                            <p class="text-xs text-gray-500">${order.address?.phone || ''}</p>
                        </div>
                    </td>
                    <td class="px-6 py-4">${order.items?.length || 0} items</td>
                    <td class="px-6 py-4 font-medium">‚Çπ${(order.total || 0).toLocaleString('en-IN')}</td>
                    <td class="px-6 py-4">
                        <span class="text-xs">${order.paymentMethod === 'razorpay' ? 'üí≥ Razorpay' : 'üí∞ Wallet'}</span>
                    </td>
                    <td class="px-6 py-4">
                        <select onchange="updateOrderStatus('${order.id}', this.value)" 
                            class="px-2 py-1 rounded-lg text-xs font-medium border-0 status-${order.status || 'confirmed'}">
                            <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                            <option value="processing" ${order.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                        </select>
                    </td>
                    <td class="px-6 py-4 text-gray-500">${formatDate(order.createdAt)}</td>
                    <td class="px-6 py-4">
                        <div class="flex gap-2">
                            <button onclick="viewOrder('${order.id}')" class="p-2 hover:bg-gray-100 rounded-lg" title="View">
                                üëÅÔ∏è
                            </button>
                            <button onclick="openShippingModal('${order.id}')" class="p-2 hover:bg-gray-100 rounded-lg" title="Ship">
                                üöö
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function filterOrders() {
            const status = document.getElementById('filter-status').value;
            const date = document.getElementById('filter-date').value;
            const search = document.getElementById('search-orders').value.toLowerCase();
            
            let filtered = [...orders];
            
            if (status) {
                filtered = filtered.filter(o => o.status === status);
            }
            
            if (date) {
                const now = new Date();
                filtered = filtered.filter(o => {
                    const orderDate = new Date(o.createdAt);
                    if (date === 'today') return orderDate.toDateString() === now.toDateString();
                    if (date === 'week') return (now - orderDate) < 7 * 24 * 60 * 60 * 1000;
                    if (date === 'month') return orderDate.getMonth() === now.getMonth();
                    return true;
                });
            }
            
            if (search) {
                filtered = filtered.filter(o => 
                    o.id.toLowerCase().includes(search) ||
                    (o.address?.fullName || '').toLowerCase().includes(search)
                );
            }
            
            // Re-render with filtered data
            const container = document.getElementById('orders-table');
            container.innerHTML = filtered.map(order => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-pickle-600">${order.id}</td>
                    <td class="px-6 py-4">
                        <div>
                            <p class="font-medium">${order.address?.fullName || 'N/A'}</p>
                            <p class="text-xs text-gray-500">${order.address?.phone || ''}</p>
                        </div>
                    </td>
                    <td class="px-6 py-4">${order.items?.length || 0} items</td>
                    <td class="px-6 py-4 font-medium">‚Çπ${(order.total || 0).toLocaleString('en-IN')}</td>
                    <td class="px-6 py-4">
                        <span class="text-xs">${order.paymentMethod === 'razorpay' ? 'üí≥ Razorpay' : 'üí∞ Wallet'}</span>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium status-${order.status || 'confirmed'}">
                            ${(order.status || 'confirmed').charAt(0).toUpperCase() + (order.status || 'confirmed').slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-gray-500">${formatDate(order.createdAt)}</td>
                    <td class="px-6 py-4">
                        <div class="flex gap-2">
                            <button onclick="viewOrder('${order.id}')" class="p-2 hover:bg-gray-100 rounded-lg">üëÅÔ∏è</button>
                            <button onclick="openShippingModal('${order.id}')" class="p-2 hover:bg-gray-100 rounded-lg">üöö</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        function updateOrderStatus(orderId, status) {
            const order = orders.find(o => o.id === orderId);
            if (order) {
                order.status = status;
                if (status === 'shipped') {
                    order.shippedAt = new Date().toISOString();
                }
                if (status === 'delivered') {
                    order.deliveredAt = new Date().toISOString();
                }
                localStorage.setItem('seasalt_orders', JSON.stringify(orders));
                showToast(`Order ${orderId} updated to ${status}`);
                loadData();
            }
        }
        
        function viewOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            selectedOrderId = orderId;
            
            const content = document.getElementById('order-modal-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Order Info -->
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm text-gray-500">Order ID</p>
                            <p class="text-xl font-bold text-pickle-600">${order.id}</p>
                        </div>
                        <span class="px-3 py-1 rounded-full text-sm font-medium status-${order.status || 'confirmed'}">
                            ${(order.status || 'confirmed').charAt(0).toUpperCase() + (order.status || 'confirmed').slice(1)}
                        </span>
                    </div>
                    
                    <!-- Customer Info -->
                    <div class="bg-gray-50 rounded-xl p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Customer Details</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="text-gray-500">Name:</span> ${order.address?.fullName || 'N/A'}</p>
                            <p><span class="text-gray-500">Phone:</span> ${order.address?.phone || 'N/A'}</p>
                            <p><span class="text-gray-500">Address:</span> ${order.address?.address || 'N/A'}</p>
                            <p><span class="text-gray-500">City:</span> ${order.address?.city || 'N/A'}, ${order.address?.state || ''} - ${order.address?.pincode || ''}</p>
                        </div>
                    </div>
                    
                    <!-- Items -->
                    <div>
                        <h4 class="font-medium text-gray-800 mb-3">Order Items</h4>
                        <div class="space-y-3">
                            ${(order.items || []).map(item => `
                                <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-xl">
                                    <img src="${item.image || '/images/placeholder.jpg'}" class="w-16 h-16 rounded-lg object-cover">
                                    <div class="flex-1">
                                        <p class="font-medium">${item.name}</p>
                                        <p class="text-sm text-gray-500">${item.weight || ''} √ó ${item.quantity}</p>
                                    </div>
                                    <p class="font-medium">‚Çπ${((item.price || 0) * (item.quantity || 1)).toLocaleString('en-IN')}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Payment Info -->
                    <div class="bg-gray-50 rounded-xl p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Payment Details</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span class="text-gray-500">Subtotal</span>
                                <span>‚Çπ${(order.subtotal || 0).toLocaleString('en-IN')}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-500">Delivery</span>
                                <span>${order.delivery === 0 ? 'FREE' : '‚Çπ' + (order.delivery || 50)}</span>
                            </div>
                            ${order.walletUsed > 0 ? `
                            <div class="flex justify-between text-green-600">
                                <span>Wallet Used</span>
                                <span>-‚Çπ${order.walletUsed}</span>
                            </div>
                            ` : ''}
                            <div class="flex justify-between font-bold text-lg pt-2 border-t">
                                <span>Total</span>
                                <span class="text-pickle-600">‚Çπ${(order.total || 0).toLocaleString('en-IN')}</span>
                            </div>
                            <p class="text-xs text-gray-400 mt-2">
                                Payment: ${order.paymentMethod === 'razorpay' ? 'Razorpay' : 'Wallet'} 
                                ${order.paymentId ? `(${order.paymentId})` : ''}
                            </p>
                        </div>
                    </div>
                    
                    <!-- Shipping Info -->
                    ${order.shipping ? `
                    <div class="bg-blue-50 rounded-xl p-4">
                        <h4 class="font-medium text-gray-800 mb-3">Shipping Details</h4>
                        <div class="space-y-2 text-sm">
                            <p><span class="text-gray-500">Partner:</span> ${order.shipping.partner}</p>
                            <p><span class="text-gray-500">Tracking #:</span> ${order.shipping.trackingNumber}</p>
                            ${order.shipping.notes ? `<p><span class="text-gray-500">Notes:</span> ${order.shipping.notes}</p>` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Actions -->
                    <div class="flex gap-3">
                        <button onclick="openShippingModal('${order.id}')" class="flex-1 py-3 bg-pickle-500 text-white rounded-xl font-medium hover:bg-pickle-600">
                            üöö Assign Shipping
                        </button>
                        <button onclick="printOrder('${order.id}')" class="px-4 py-3 border rounded-xl hover:bg-gray-50">
                            üñ®Ô∏è
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('order-modal').classList.remove('hidden');
        }
        
        function closeOrderModal() {
            document.getElementById('order-modal').classList.add('hidden');
            selectedOrderId = null;
        }
        
        function printOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head><title>Order ${order.id}</title></head>
                <body style="font-family: Arial, sans-serif; padding: 20px;">
                    <h1>Order ${order.id}</h1>
                    <p><strong>Customer:</strong> ${order.address?.fullName}</p>
                    <p><strong>Phone:</strong> ${order.address?.phone}</p>
                    <p><strong>Address:</strong> ${order.address?.address}, ${order.address?.city}, ${order.address?.state} - ${order.address?.pincode}</p>
                    <hr>
                    <h3>Items:</h3>
                    <ul>
                        ${(order.items || []).map(i => `<li>${i.name} (${i.weight}) √ó ${i.quantity} - ‚Çπ${i.price * i.quantity}</li>`).join('')}
                    </ul>
                    <hr>
                    <p><strong>Total:</strong> ‚Çπ${order.total}</p>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        // ============================================
        // SHIPPING
        // ============================================
        
        function renderPendingShipments() {
            const container = document.getElementById('pending-shipments');
            const pending = orders.filter(o => o.status === 'confirmed' || o.status === 'processing');
            
            if (pending.length === 0) {
                container.innerHTML = `
                    <div class="p-12 text-center text-gray-500">
                        <div class="text-4xl mb-2">‚úÖ</div>
                        <p>No pending shipments</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pending.map(order => `
                <div class="p-4 hover:bg-gray-50 flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 bg-pickle-100 rounded-xl flex items-center justify-center">
                            <span class="text-xl">üì¶</span>
                        </div>
                        <div>
                            <p class="font-medium">${order.id}</p>
                            <p class="text-sm text-gray-500">${order.address?.fullName} ‚Ä¢ ${order.address?.city}</p>
                        </div>
                    </div>
                    <button onclick="openShippingModal('${order.id}')" 
                        class="px-4 py-2 bg-pickle-500 text-white rounded-lg text-sm font-medium hover:bg-pickle-600">
                        Ship Now
                    </button>
                </div>
            `).join('');
        }
        
        function renderShipmentsTable() {
            const container = document.getElementById('shipments-table');
            const shipped = orders.filter(o => o.shipping);
            
            if (shipped.length === 0) {
                container.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">
                            No shipments yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            container.innerHTML = shipped.map(order => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-medium text-pickle-600">${order.id}</td>
                    <td class="px-6 py-4">${order.address?.fullName || 'N/A'}</td>
                    <td class="px-6 py-4">${order.address?.city || ''}, ${order.address?.pincode || ''}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 bg-gray-100 rounded text-xs font-medium uppercase">${order.shipping?.partner || 'N/A'}</span>
                    </td>
                    <td class="px-6 py-4 font-mono text-sm">${order.shipping?.trackingNumber || 'N/A'}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium status-${order.status}">
                            ${order.status.charAt(0).toUpperCase() + order.status.slice(1)}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
        
        function openShippingModal(orderId) {
            selectedOrderId = orderId;
            document.getElementById('shipping-order-id').textContent = orderId;
            document.getElementById('shipping-partner').value = '';
            document.getElementById('tracking-number').value = '';
            document.getElementById('shipping-notes').value = '';
            document.getElementById('shipping-modal').classList.remove('hidden');
            closeOrderModal();
        }
        
        function closeShippingModal() {
            document.getElementById('shipping-modal').classList.add('hidden');
            selectedOrderId = null;
        }
        
        function confirmShipping() {
            const partner = document.getElementById('shipping-partner').value;
            const trackingNumber = document.getElementById('tracking-number').value;
            const notes = document.getElementById('shipping-notes').value;
            
            if (!partner) {
                showToast('Please select a shipping partner');
                return;
            }
            
            if (!trackingNumber) {
                showToast('Please enter tracking number');
                return;
            }
            
            const order = orders.find(o => o.id === selectedOrderId);
            if (order) {
                order.status = 'shipped';
                order.shippedAt = new Date().toISOString();
                order.shipping = {
                    partner,
                    trackingNumber,
                    notes,
                    assignedAt: new Date().toISOString()
                };
                
                localStorage.setItem('seasalt_orders', JSON.stringify(orders));
                closeShippingModal();
                loadData();
                showToast(`Order ${selectedOrderId} shipped via ${partner}!`);
            }
        }
        
        // ============================================
        // UTILITIES
        // ============================================
        
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-message').textContent = message;
            toast.classList.remove('hidden', 'translate-y-4', 'opacity-0');
            
            setTimeout(() => {
                toast.classList.add('translate-y-4', 'opacity-0');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }
        
        // ============================================
        // ANALYTICS
        // ============================================
        
        let deviceChart = null;
        
        // Supabase analytics connection
        const SB_ANALYTICS = 'https://yosjbsncvghpscsrvxds.supabase.co/rest/v1/';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlvc2pic25jdmdocHNjc3J2eGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAyMjc3NTgsImV4cCI6MjA4NTgwMzc1OH0.PNEbeofoyT7KdkzepRfqg-zqyBiGAat5ElCMiyQ4UAs';
        const SB_HDRS = { 'apikey': SB_KEY, 'Authorization': 'Bearer ' + SB_KEY };

        function loadAnalyticsData() {
            // Fetch real analytics from Supabase
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            const fromDate = sevenDaysAgo.toISOString();

            Promise.all([
                fetch(SB_ANALYTICS + 'analytics_events?select=*&created_at=gte.' + fromDate + '&order=created_at.desc&limit=500', { headers: SB_HDRS })
                    .then(r => r.json()).catch(() => []),
                fetch(SB_ANALYTICS + 'analytics_daily?select=*&order=date.desc&limit=30', { headers: SB_HDRS })
                    .then(r => r.json()).catch(() => [])
            ]).then(([events, dailyRows]) => {
                if ((!events || events.length === 0) && (!dailyRows || dailyRows.length === 0)) {
                    showEmptyAnalytics();
                    return;
                }
                const report = generateAnalyticsReport(events || [], dailyRows || []);
                renderAnalyticsSummary(report);
                renderFunnel(report.funnel);
                renderPagePerformance(report.pageStats);
                renderDeviceChart(report.devices);
                renderSources(report.sources);
                renderTopProducts(report.topProducts);
                renderEventsFeed(report.recentEvents);
            }).catch(() => {
                showEmptyAnalytics();
            });
        }
        
        function generateAnalyticsReport(events, dailyRows) {
            const sessions = {};
            let pageViews = 0, productViews = 0, cartAdds = 0, checkouts = 0, purchases = 0, revenue = 0;
            const devices = { mobile: 0, desktop: 0, tablet: 0 };
            const sources = {};
            const productStats = {};
            const pageStats = {};

            (events || []).forEach(e => {
                // Sessions
                if (e.session_id && !sessions[e.session_id]) {
                    sessions[e.session_id] = { start: e.created_at, device: e.device, referrer: e.referrer };
                    const dev = e.device || 'desktop';
                    devices[dev] = (devices[dev] || 0) + 1;
                    let src = e.referrer || 'direct';
                    if (src !== 'direct') {
                        try { src = new URL(src).hostname; } catch(x) { src = 'other'; }
                    } else { src = 'Direct'; }
                    sources[src] = (sources[src] || 0) + 1;
                }

                switch(e.event_type) {
                    case 'page_view':
                        pageViews++;
                        const pg = e.page || 'home';
                        if (!pageStats[pg]) pageStats[pg] = { visits: 0, totalTime: 0, avgTime: 0, bounces: 0 };
                        pageStats[pg].visits++;
                        break;
                    case 'product_view':
                        productViews++;
                        if (e.label) {
                            if (!productStats[e.label]) productStats[e.label] = { views: 0, cartAdds: 0, purchases: 0 };
                            productStats[e.label].views++;
                        }
                        break;
                    case 'add_to_cart':
                        cartAdds++;
                        if (e.label) {
                            if (!productStats[e.label]) productStats[e.label] = { views: 0, cartAdds: 0, purchases: 0 };
                            productStats[e.label].cartAdds++;
                        }
                        break;
                    case 'checkout_start': checkouts++; break;
                    case 'purchase':
                        purchases++;
                        revenue += (e.value || 0);
                        break;
                }
            });

            const totalSessions = Object.keys(sessions).length;

            // Daily data for charts
            const dailyData = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                const found = (dailyRows || []).find(r => r.date === dateStr);
                dailyData.push({
                    date: dateStr,
                    views: found ? found.views : 0,
                    uniqueUsers: found ? Array(found.unique_users || 0).fill(0) : [],
                    cartAdds: found ? found.cart_adds : 0,
                    checkouts: found ? found.checkouts : 0,
                    purchases: found ? found.purchases : 0,
                    revenue: found ? found.revenue : 0
                });
            }

            const topProducts = Object.entries(productStats)
                .map(([id, stats]) => ({ id, name: id, ...stats }))
                .sort((a, b) => b.views - a.views)
                .slice(0, 10);

            const recentEvents = (events || []).slice(0, 50).map(e => ({
                category: e.event_type,
                action: e.action || '',
                label: e.label || '',
                page: e.page || '',
                timestamp: new Date(e.created_at).getTime()
            }));

            const conversionRate = pageViews > 0 ? (purchases / pageViews * 100) : 0;

            return {
                summary: {
                    totalSessions,
                    totalPageViews: pageViews,
                    avgSessionDuration: 0,
                    bounceRate: '0.0',
                    conversionRate: conversionRate.toFixed(2)
                },
                funnel: { views: pageViews, productViews, cartAdds, checkoutStarts: checkouts, purchases },
                pageStats,
                devices,
                sources,
                topProducts,
                recentEvents,
                dailyData
            };
        }
        
        function renderAnalyticsSummary(report) {
            document.getElementById('analytics-sessions').textContent = report.summary.totalSessions;
            document.getElementById('analytics-pageviews').textContent = report.summary.totalPageViews;
            document.getElementById('analytics-avgsession').textContent = formatDuration(report.summary.avgSessionDuration);
            document.getElementById('analytics-bounce').textContent = report.summary.bounceRate + '%';
            document.getElementById('analytics-conversion').textContent = report.summary.conversionRate + '%';
        }
        
        function renderFunnel(funnel) {
            document.getElementById('funnel-views').textContent = funnel.views;
            document.getElementById('funnel-product').textContent = funnel.productViews;
            document.getElementById('funnel-cart').textContent = funnel.cartAdds;
            document.getElementById('funnel-checkout').textContent = funnel.checkoutStarts;
            document.getElementById('funnel-purchase').textContent = funnel.purchases;
            
            const views = funnel.views || 1;
            document.getElementById('funnel-product-pct').textContent = ((funnel.productViews / views) * 100).toFixed(1) + '%';
            document.getElementById('funnel-cart-pct').textContent = ((funnel.cartAdds / views) * 100).toFixed(1) + '%';
            document.getElementById('funnel-checkout-pct').textContent = ((funnel.checkoutStarts / views) * 100).toFixed(1) + '%';
            document.getElementById('funnel-purchase-pct').textContent = ((funnel.purchases / views) * 100).toFixed(1) + '%';
        }
        
        function renderPagePerformance(pageStats) {
            const container = document.getElementById('page-performance-table');
            const pages = Object.entries(pageStats)
                .map(([page, stats]) => ({ page, ...stats }))
                .sort((a, b) => b.visits - a.visits);
            
            if (pages.length === 0) {
                container.innerHTML = '<tr><td colspan="4" class="py-8 text-center text-gray-500">No page data yet</td></tr>';
                return;
            }
            
            container.innerHTML = pages.map(p => `
                <tr class="border-b">
                    <td class="py-3 font-medium">${p.page}</td>
                    <td class="py-3">${p.visits}</td>
                    <td class="py-3">${formatDuration(p.avgTime / 1000)}</td>
                    <td class="py-3">${p.visits > 0 ? ((p.bounces / p.visits) * 100).toFixed(0) : 0}%</td>
                </tr>
            `).join('');
        }
        
        function renderDeviceChart(devices) {
            const ctx = document.getElementById('device-chart').getContext('2d');
            
            if (deviceChart) {
                deviceChart.destroy();
            }
            
            deviceChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Mobile', 'Desktop', 'Tablet'],
                    datasets: [{
                        data: [devices.mobile, devices.desktop, devices.tablet],
                        backgroundColor: ['#3B82F6', '#10B981', '#F59E0B']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        
        function renderSources(sources) {
            const container = document.getElementById('sources-list');
            const total = Object.values(sources).reduce((sum, v) => sum + v, 0) || 1;
            
            const sorted = Object.entries(sources)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            if (sorted.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">No traffic data yet</p>';
                return;
            }
            
            container.innerHTML = sorted.map(([source, count]) => `
                <div class="flex items-center justify-between text-sm">
                    <span class="truncate">${source}</span>
                    <span class="font-medium">${((count / total) * 100).toFixed(0)}%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-1.5 mb-2">
                    <div class="bg-pickle-500 h-1.5 rounded-full" style="width: ${(count / total) * 100}%"></div>
                </div>
            `).join('');
        }
        
        function renderTopProducts(products) {
            const container = document.getElementById('top-products-table');
            
            if (products.length === 0) {
                container.innerHTML = '<tr><td colspan="6" class="px-6 py-12 text-center text-gray-500">No product data yet</td></tr>';
                return;
            }
            
            container.innerHTML = products.map(p => {
                const convRate = p.views > 0 ? ((p.purchases / p.views) * 100).toFixed(1) : 0;
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 font-medium">${p.name || p.id}</td>
                        <td class="px-6 py-4">${p.views}</td>
                        <td class="px-6 py-4">${p.cartAdds}</td>
                        <td class="px-6 py-4">${p.purchases}</td>
                        <td class="px-6 py-4">‚Çπ${(p.revenue || 0).toLocaleString('en-IN')}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded-full text-xs ${convRate > 5 ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600'}">
                                ${convRate}%
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function renderEventsFeed(events) {
            const container = document.getElementById('events-feed');
            
            if (events.length === 0) {
                container.innerHTML = '<div class="p-12 text-center text-gray-500">No events recorded yet</div>';
                return;
            }
            
            const icons = {
                'Page': 'üìÑ',
                'Product': 'üè∑Ô∏è',
                'Cart': 'üõí',
                'Checkout': 'üí≥',
                'Purchase': '‚úÖ',
                'Search': 'üîç',
                'Click': 'üëÜ',
                'Scroll': 'üìú',
                'Session': 'üë§'
            };
            
            container.innerHTML = events.map(e => `
                <div class="p-4 hover:bg-gray-50 flex items-center gap-4">
                    <div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center">
                        <span>${icons[e.category] || 'üìä'}</span>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-sm">${e.category}: ${e.action}</p>
                        <p class="text-xs text-gray-500">${e.label || ''} ${e.value ? '‚Ä¢ ‚Çπ' + e.value : ''}</p>
                    </div>
                    <div class="text-xs text-gray-400">
                        ${formatTimeAgo(e.timestamp)}
                    </div>
                </div>
            `).join('');
        }
        
        function showEmptyAnalytics() {
            document.getElementById('analytics-sessions').textContent = '0';
            document.getElementById('analytics-pageviews').textContent = '0';
            document.getElementById('analytics-avgsession').textContent = '0s';
            document.getElementById('analytics-bounce').textContent = '0%';
            document.getElementById('analytics-conversion').textContent = '0%';
        }
        
        function clearAnalyticsData() {
            if (confirm('Are you sure you want to clear all analytics data? This cannot be undone.')) {
                localStorage.removeItem('seasalt_analytics');
                loadAnalyticsData();
                showToast('Analytics data cleared');
            }
        }
        
        function formatDuration(seconds) {
            if (seconds < 60) return Math.round(seconds) + 's';
            if (seconds < 3600) return Math.round(seconds / 60) + 'm';
            return Math.round(seconds / 3600) + 'h';
        }
        
        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + 'm ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + 'h ago';
            return Math.floor(seconds / 86400) + 'd ago';
        }
        
        // ============================================
        // INIT
        // ============================================
        
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            
            // Search input handler
            document.getElementById('search-orders').addEventListener('input', filterOrders);
            
            // Enter key for login
            document.getElementById('admin-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
        });
    </script>
</body>
</html>
